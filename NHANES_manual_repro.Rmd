---
title: "NHANES_Manual_Reproduce"
author: "HEIR Analyst Claudia Solis-Roman"
date: "November 11, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

# NHANES Analysis Reproduce Manual
# Manual for Visualizing how the Relationship between Blood Pressure and Risk for Heart Attack Varies by Race for Women Ages 50 and Above”


## Objective
This Health Equity Institute of Research (HEIR) manual is intended to serve as a reference for junior analysts on how to perform routine data analyses for the website to help inform health policy for Health Equity Org. It includes training to help analysts like yourself perform some basic data cleaning, analysis, and visualization methods in R. In this manual, we will be producing statistics for our female heart health scorecard, looking closely at women above age 50 and examining how race interacts with high blood pressure and risk for heart attack.

## Step 0. Environment set up
```{r, results="hide"}
if(!requireNamespace("here"))
  install.packages("here", repos = "https://cloud.r-project.org")
library("here")
here::here()

if(!requireNamespace("table1"))
  install.packages("table1", repos = "https://cloud.r-project.org")
library("table1")

if(!requireNamespace("readstata13"))
  install.packages("readstata13", repos = "https://cloud.r-project.org")
library("readstata13")

#if(!requireNamespace("dplyr"))
 # install.packages("dplyr", repos = "https://cloud.r-project.org")
#library("dplyr")

source(here("src", "script.R"))

packrat::init
library(c("table1"))
```

## Step 1. Open and Clean Data
We will use data from the Center for Disease Control's National Health and Nutrition Examination Survey II (NHANES II) for this assignment. A Stata version of this dataset can be found at http://www.stata-press.com/data/r14/nhanes2.dta (here). For the purposes of this analysis,we are not required to use the survey weights. We use read data 13 to read in Stata 13 data from the online location, save the attributes so we can quickly view the variable labels here in conjunction with NHANES documentation. 

```{r, echo=TRUE}
nhanes <- read.dta13("http://www.stata-press.com/data/r14/nhanes2.dta")
var.labels <- attr(data, "var.labels")
```

We then subselect from he data as a whole using base R to arrive at our population of interest, women over age at or above age 50. 

```{r}
nhanes <- nhanes[nhanes$sex==women &nhanes$age>=50]


```

## Step 2. Tables for 5 variables

2. Create a summary table or figure with descriptive statistics for at least 5 variables. Make sure that
the summaries are appropriate for the type of data being described (e.g. do not use a 5-number
summary for a binary variable!).

```{r}

table1::label(nhanes$age) <-"Age"
table1::label(nhanes$race) <-"Race"
table1::label(nhanes$hbpressure) <-"High Blood Pressure"
table1::label(nhanes$heartatk) <- "Heart Attack"

table1::table1(~heartatk + hbpressure + age | race,data=nhanes)

```


## Step 3. Describe results
3. Provide a brief description of what the table/figure shows you.

## Step 4. 
4. Perform an analysis or create a visualization that will be useful to your organization. [Note to
student: you can use any command that you want as long as (a) it incorporates at least two
variables and (b) you have never used it before.] Describe why you chose that command (how it
uses data to inform the mission of the organization) and how you implemented it. Examples of
types of commands: visualizations (graphs, charts, plots), data sorting, missing data summaries,
predictive models. Pie charts of any sort are not allowed!

## Step 5. 
5. Bundle this using packrat as demonstrated by Vicky Steeves.

```{r}
packrat::bundle
```

6. Create a title for your manual that is appropriate given what you did, for instance “Manual for
visualizing how the relationship between blood pressure and heart attacks varies by race”


